import logging
from telegram import (
    Update,
    ReplyKeyboardMarkup,
    ReplyKeyboardRemove
)
from telegram.ext import (
    ApplicationBuilder,
    ContextTypes,
    CommandHandler,
    MessageHandler,
    filters
)

# ================= –ù–ê–°–¢–†–û–ô–ö–ò =================

BOT_TOKEN = "PASTE_YOUR_REAL_TOKEN_HERE"

FULL_ADMINS = [111111111]        # ID —Ñ—É–ª–ª –∞–¥–º–∏–Ω–æ–≤
DEFAULT_ADMINS = [222222222]     # ID –æ–±—ã—á–Ω—ã—Ö –∞–¥–º–∏–Ω–æ–≤

# ================= –õ–û–ì–ò =================

logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    level=logging.INFO
)

# ================= –ö–ù–û–ü–ö–ò =================

main_keyboard = ReplyKeyboardMarkup(
    [
        ["‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ"],
        ["‚ÑπÔ∏è –û –±–æ—Ç–µ"]
    ],
    resize_keyboard=True
)

# –∫—Ç–æ —Å–µ–π—á–∞—Å –ø–∏—à–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
WAITING_USERS = set()

# ================= /start =================

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "–ü—Ä–∏–≤–µ—Ç! –¢—ã –º–æ–∂–µ—à—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–æ–Ω–∏–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ üëá",
        reply_markup=main_keyboard
    )

# ================= –ö–ù–û–ü–ö–ê ¬´–ù–ê–ü–ò–°–ê–¢–¨¬ª =================

async def write_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    WAITING_USERS.add(update.effective_user.id)
    await update.message.reply_text(
        "‚úçÔ∏è –ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å –º–µ–¥–∏–∞",
        reply_markup=ReplyKeyboardRemove()
    )

# ================= –ö–ù–û–ü–ö–ê ¬´–û –ë–û–¢–ï¬ª =================

async def about_bot(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "ü§ñ –ê–Ω–æ–Ω–∏–º–Ω—ã–π –±–æ—Ç –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π\n\n"
        "–¢—ã –º–æ–∂–µ—à—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –∏–ª–∏ –º–µ–¥–∏–∞ –∞–Ω–æ–Ω–∏–º–Ω–æ.",
        reply_markup=main_keyboard
    )

# ================= –û–°–ù–û–í–ù–û–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö =================

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user = update.effective_user
    msg = update.message

    if user.id not in WAITING_USERS:
        return

    WAITING_USERS.remove(user.id)

    name = user.first_name or "–ë–µ–∑ –∏–º–µ–Ω–∏"
    username = f"@{user.username}" if user.username else "–Ω–µ—Ç username"
    uid = user.id

    text = msg.text or ""

    media = None
    media_type = ""

    if msg.photo:
        media = msg.photo[-1].file_id
        media_type = "üì∑ –§–æ—Ç–æ"
    elif msg.video:
        media = msg.video.file_id
        media_type = "üé• –í–∏–¥–µ–æ"
    elif msg.voice:
        media = msg.voice.file_id
        media_type = "üé§ –ì–æ–ª–æ—Å–æ–≤–æ–µ"
    elif msg.video_note:
        media = msg.video_note.file_id
        media_type = "üìπ –ö—Ä—É–∂–æ–∫"
    elif msg.audio:
        media = msg.audio.file_id
        media_type = "üéµ –ú—É–∑—ã–∫–∞"

    # ---------- FULL ADMINS ----------
    for admin_id in FULL_ADMINS:
        caption = (
            "–ü—Ä–∏—à–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç:\n"
            f"üë§ {name}\n"
            f"üîó {username}\n"
            f"üÜî {uid}\n"
        )

        if text:
            caption += f"üí¨ {text}\n"

        if media_type:
            caption += media_type

        if media:
            if msg.photo:
                await context.bot.send_photo(admin_id, media, caption=caption)
            elif msg.video:
                await context.bot.send_video(admin_id, media, caption=caption)
            elif msg.voice:
                await context.bot.send_voice(admin_id, media, caption=caption)
            elif msg.audio:
                await context.bot.send_audio(admin_id, media, caption=caption)
            elif msg.video_note:
                await context.bot.send_video_note(admin_id, media)
                await context.bot.send_message(admin_id, caption)
        else:
            await context.bot.send_message(admin_id, caption)

    # ---------- DEFAULT ADMINS ----------
    for admin_id in DEFAULT_ADMINS:
        caption = "–£ —Ç–µ–±—è –Ω–æ–≤–æ–µ –∞–Ω–æ–Ω–∏–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!\n\n"

        if text:
            caption += f"{text}\n\n"

        caption += "@anonymousaskkbot"

        if media:
            if msg.photo:
                await context.bot.send_photo(admin_id, media, caption=caption)
            elif msg.video:
                await context.bot.send_video(admin_id, media, caption=caption)
            elif msg.voice:
                await context.bot.send_voice(admin_id, media, caption=caption)
            elif msg.audio:
                await context.bot.send_audio(admin_id, media, caption=caption)
            elif msg.video_note:
                await context.bot.send_video_note(admin_id, media)
                await context.bot.send_message(admin_id, caption)
        else:
            await context.bot.send_message(admin_id, caption)

    await msg.reply_text(
        "‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–Ω–æ–Ω–∏–º–Ω–æ",
        reply_markup=main_keyboard
    )

# ================= –ó–ê–ü–£–°–ö =================

def main():
    app = ApplicationBuilder().token(BOT_TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.Regex("^‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ$"), write_message))
    app.add_handler(MessageHandler(filters.Regex("^‚ÑπÔ∏è –û –±–æ—Ç–µ$"), about_bot))
    app.add_handler(MessageHandler(filters.ALL & ~filters.COMMAND, handle_message))

    app.run_polling()

if __name__ == "__main__":
    main()
